package com.url_shortener.controller;import com.url_shortener.dtos.ClickEventDTO;import com.url_shortener.dtos.UrlMappingDTO;import com.url_shortener.models.User;import com.url_shortener.service.UrlMappingService;import com.url_shortener.service.UserService;import lombok.AllArgsConstructor;import org.springframework.format.annotation.DateTimeFormat;import org.springframework.http.ResponseEntity;import org.springframework.security.access.prepost.PreAuthorize;import org.springframework.web.bind.annotation.*;import java.security.Principal;import java.time.LocalDate;import java.time.LocalDateTime;import java.util.List;import java.util.Map;@RestController@RequestMapping("/api/urls")@AllArgsConstructorpublic class UrlMappingController {    private UrlMappingService urlMappingService;    private UserService userService;    @PostMapping("/shorten")    @PreAuthorize("hasRole('USER')")    public ResponseEntity<UrlMappingDTO> createShortUrl(            @RequestBody Map<String, String> request,            Principal principal) {        String originalUrl = request.get("originalUrl");        User user = userService.findByUsername(principal.getName());        UrlMappingDTO urlMappingDTO =                urlMappingService.createShortUrl(originalUrl, user);        return ResponseEntity.ok(urlMappingDTO);    }    @GetMapping("/myurls")    @PreAuthorize("hasRole('USER')")    public ResponseEntity<List<UrlMappingDTO>> getUserUrls(            Principal principal) {        User user = userService.findByUsername(principal.getName());        List<UrlMappingDTO> urls =                urlMappingService.getUrlsByUser(user);        return ResponseEntity.ok(urls);    }    // ðŸ”¥ FIXED ANALYTICS ENDPOINT    @GetMapping("/analytics/{shortUrl}")    @PreAuthorize("hasRole('USER')")    public ResponseEntity<List<ClickEventDTO>> getUrlAnalytics(            @PathVariable String shortUrl,            @RequestParam("startDate")            @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)            LocalDateTime startDate,            @RequestParam("endDate")            @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)            LocalDateTime endDate) {        List<ClickEventDTO> clickEventDTOS =                urlMappingService.getClickEventsByDate(shortUrl, startDate, endDate);        return ResponseEntity.ok(clickEventDTOS);    }    @GetMapping("/totalClicks")    @PreAuthorize("hasRole('USER')")    public ResponseEntity<Map<LocalDate, Long>> getTotalClicksByDate(            Principal principal,            @RequestParam("startDate")            @DateTimeFormat(iso = DateTimeFormat.ISO.DATE)            LocalDate startDate,            @RequestParam("endDate")            @DateTimeFormat(iso = DateTimeFormat.ISO.DATE)            LocalDate endDate) {        User user = userService.findByUsername(principal.getName());        Map<LocalDate, Long> totalClicks =                urlMappingService.getTotalClicksByUserAndDate(user, startDate, endDate);        return ResponseEntity.ok(totalClicks);    }}